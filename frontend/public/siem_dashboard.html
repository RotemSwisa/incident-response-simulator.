<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIEM Dashboard - IR Training</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .event-stream { max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; }
        .event-item { padding: 8px; border-bottom: 1px solid #e5e7eb; transition: background 0.2s; }
        .event-item:hover { background: #f9fafb; }
        .severity-critical { border-left: 4px solid #dc2626; }
        .severity-high { border-left: 4px solid #ea580c; }
        .severity-medium { border-left: 4px solid #eab308; }
        .severity-low { border-left: 4px solid #3b82f6; }
        .severity-info { border-left: 4px solid #6b7280; }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const SIEMDashboard = () => {
            const [events, setEvents] = useState([]);
            const [isRunning, setIsRunning] = useState(false);
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterSeverity, setFilterSeverity] = useState('all');
            const [filterSource, setFilterSource] = useState('all');
            const [alertCount, setAlertCount] = useState(0);
            const intervalRef = useRef(null);

            const eventSources = ['Firewall-Primary', 'IDS-Core', 'Windows-DC01', 'Linux-WebSrv01', 
                                  'EDR-Endpoint', 'Email-Gateway', 'Proxy-DMZ', 'VPN-Concentrator'];

            const eventTemplates = {
                CRITICAL: [
                    'Multiple failed authentication attempts detected from {ip}',
                    'Malware signature match: Trojan.Generic detected on {host}',
                    'Data exfiltration detected: {size}MB transferred to external IP {ip}',
                    'Privilege escalation attempt detected on {host}',
                    'Ransomware behavior detected: Mass file encryption on {host}'
                ],
                HIGH: [
                    'Port scan detected from {ip} targeting {count} hosts',
                    'Suspicious PowerShell execution on {host}',
                    'Unauthorized access attempt to {resource}',
                    'SQL injection attempt detected from {ip}',
                    'Brute force attack detected on service {service}'
                ],
                MEDIUM: [
                    'Failed login attempt for user {user} from {ip}',
                    'Unusual outbound connection to {ip}',
                    'Policy violation: USB device connected to {host}',
                    'Suspicious file download: {file} from {host}'
                ],
                LOW: [
                    'User {user} logged in from new location',
                    'Firewall rule triggered: Connection from {ip} blocked',
                    'Configuration change detected on {host}'
                ],
                INFO: [
                    'System backup completed successfully',
                    'User {user} logged in successfully',
                    'Security patch applied to {host}',
                    'Firewall rules synchronized'
                ]
            };

            const generateEvent = () => {
                const severity = Math.random() < 0.5 ? 'INFO' : 
                                Math.random() < 0.75 ? 'LOW' :
                                Math.random() < 0.90 ? 'MEDIUM' :
                                Math.random() < 0.97 ? 'HIGH' : 'CRITICAL';
                                
                const source = eventSources[Math.floor(Math.random() * eventSources.length)];
                const template = eventTemplates[severity][Math.floor(Math.random() * eventTemplates[severity].length)];
                
                const message = template
                    .replace('{ip}', `${Math.floor(Math.random() * 223) + 1}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`)
                    .replace('{host}', `WS-${Math.floor(Math.random() * 100)}`)
                    .replace('{user}', ['alice', 'bob', 'admin'][Math.floor(Math.random() * 3)])
                    .replace('{size}', Math.floor(Math.random() * 5000))
                    .replace('{count}', Math.floor(Math.random() * 254))
                    .replace('{resource}', '/admin')
                    .replace('{service}', 'SSH')
                    .replace('{file}', 'malware.exe');

                return {
                    id: Date.now() + Math.random(),
                    timestamp: new Date().toISOString(),
                    severity,
                    source,
                    message,
                    details: {
                        eventId: `EVT-${Math.floor(Math.random() * 100000)}`,
                        category: ['Authentication', 'Network', 'Malware'][Math.floor(Math.random() * 3)]
                    }
                };
            };

            useEffect(() => {
                if (isRunning) {
                    intervalRef.current = setInterval(() => {
                        const newEvent = generateEvent();
                        setEvents(prev => [newEvent, ...prev].slice(0, 200));
                        if (newEvent.severity === 'CRITICAL' || newEvent.severity === 'HIGH') {
                            setAlertCount(prev => prev + 1);
                        }
                    }, 2000);
                }
                return () => { if (intervalRef.current) clearInterval(intervalRef.current); };
            }, [isRunning]);

            const toggleMonitoring = () => {
                setIsRunning(!isRunning);
                if (isRunning) {
                    setEvents([]);
                    setAlertCount(0);
                }
            };

            const filteredEvents = events.filter(event => {
                const matchesSearch = searchQuery === '' || 
                    event.message.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesSeverity = filterSeverity === 'all' || event.severity === filterSeverity;
                const matchesSource = filterSource === 'all' || event.source === filterSource;
                return matchesSearch && matchesSeverity && matchesSource;
            });

            const severityStats = {
                CRITICAL: events.filter(e => e.severity === 'CRITICAL').length,
                HIGH: events.filter(e => e.severity === 'HIGH').length,
                MEDIUM: events.filter(e => e.severity === 'MEDIUM').length,
                LOW: events.filter(e => e.severity === 'LOW').length,
                INFO: events.filter(e => e.severity === 'INFO').length,
            };

            return (
                <div className="min-h-screen bg-gray-900 text-gray-100">
                    <div className="bg-gray-800 border-b border-gray-700 px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                                <a href="index.html" className="text-blue-400 hover:text-blue-300">← Home</a>
                                <h1 className="text-2xl font-bold text-white">SIEM Dashboard</h1>
                                <span className={`px-3 py-1 rounded text-sm font-medium ${isRunning ? 'bg-green-600' : 'bg-gray-600'}`}>
                                    {isRunning ? '● MONITORING' : '○ STOPPED'}
                                </span>
                            </div>
                            <div className="flex items-center space-x-4">
                                <div className="text-sm">
                                    <span className="text-gray-400">Total Events:</span>
                                    <span className="ml-2 text-white font-bold">{events.length}</span>
                                </div>
                                <div className="text-sm">
                                    <span className="text-gray-400">Alerts:</span>
                                    <span className="ml-2 text-red-400 font-bold">{alertCount}</span>
                                </div>
                                <button
                                    onClick={toggleMonitoring}
                                    className={`px-6 py-2 rounded-lg font-medium transition ${
                                        isRunning ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white'
                                    }`}
                                >
                                    {isRunning ? 'Stop Monitoring' : 'Start Monitoring'}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gray-800 px-6 py-4 border-b border-gray-700">
                        <div className="flex items-center space-x-4">
                            <input
                                type="text"
                                placeholder="Search events..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white"
                            />
                            <select value={filterSeverity} onChange={(e) => setFilterSeverity(e.target.value)} className="px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                                <option value="all">All Severities</option>
                                <option value="CRITICAL">Critical</option>
                                <option value="HIGH">High</option>
                                <option value="MEDIUM">Medium</option>
                            </select>
                        </div>
                    </div>

                    <div className="p-6">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <div className="text-gray-400 text-sm mb-2">Critical Events</div>
                                <div className="text-4xl font-bold text-red-400">{severityStats.CRITICAL}</div>
                            </div>
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <div className="text-gray-400 text-sm mb-2">High Priority</div>
                                <div className="text-4xl font-bold text-orange-400">{severityStats.HIGH}</div>
                            </div>
                            <div className="bg-gray-800 rounded-lg p-6 border border-gray-700">
                                <div className="text-gray-400 text-sm mb-2">Total Events</div>
                                <div className="text-4xl font-bold text-blue-400">{events.length}</div>
                            </div>
                        </div>

                        <div className="bg-gray-800 rounded-lg border border-gray-700">
                            <div className="px-6 py-4 border-b border-gray-700">
                                <h3 className="text-lg font-semibold text-white">Live Event Stream ({filteredEvents.length})</h3>
                            </div>
                            <div className="event-stream">
                                {filteredEvents.length === 0 && (
                                    <div className="text-center py-12 text-gray-500">
                                        {isRunning ? 'Waiting for events...' : 'Click "Start Monitoring" to begin'}
                                    </div>
                                )}
                                {filteredEvents.map(event => (
                                    <div
                                        key={event.id}
                                        className={`event-item cursor-pointer severity-${event.severity.toLowerCase()}`}
                                        onClick={() => setSelectedEvent(event)}
                                    >
                                        <div className="flex items-start justify-between">
                                            <div className="flex-1">
                                                <div className="flex items-center space-x-3 mb-1">
                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${
                                                        event.severity === 'CRITICAL' ? 'bg-red-600' :
                                                        event.severity === 'HIGH' ? 'bg-orange-600' :
                                                        event.severity === 'MEDIUM' ? 'bg-yellow-600' :
                                                        'bg-gray-600'
                                                    }`}>{event.severity}</span>
                                                    <span className="text-gray-400 text-sm">{event.source}</span>
                                                    <span className="text-gray-500 text-xs">{new Date(event.timestamp).toLocaleTimeString()}</span>
                                                </div>
                                                <div className="text-white text-sm">{event.message}</div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {selectedEvent && (
                        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick={() => setSelectedEvent(null)}>
                            <div className="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4" onClick={(e) => e.stopPropagation()}>
                                <h2 className="text-2xl font-bold text-white mb-6">Event Details</h2>
                                <div className="space-y-4">
                                    <div><span className="text-gray-400">Event ID:</span> <span className="text-white">{selectedEvent.details.eventId}</span></div>
                                    <div><span className="text-gray-400">Severity:</span> <span className="text-white">{selectedEvent.severity}</span></div>
                                    <div><span className="text-gray-400">Message:</span> <div className="text-white bg-gray-900 p-4 rounded">{selectedEvent.message}</div></div>
                                </div>
                                <button onClick={() => setSelectedEvent(null)} className="mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg">Close</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(React.createElement(SIEMDashboard), document.getElementById('root'));
    </script>
</body>
</html>
